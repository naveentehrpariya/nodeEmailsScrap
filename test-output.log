ğŸ§ª TESTING CHATCONTROLLER.GETACCOUNTCHATS DIRECTLY
============================================================
(node:6091) [MONGOOSE] DeprecationWarning: Mongoose: the `strictQuery` option will be switched back to `false` by default in Mongoose 7. Use `mongoose.set('strictQuery', false);` if you want to prepare for this change. Or use `mongoose.set('strictQuery', true);` to suppress this warning.
(Use `node --trace-deprecation ...` to show where the warning was created)
âœ… Connected to database
ğŸ”„ Calling ChatController.getAccountChats...
ğŸ“„ Getting chats from database for: naveendev@crossmilescarrier.com
ğŸ‘¥ Found other participant via participants array: dispatch@crossmilescarrier.com - Cross Miles Carrier
ğŸ” Participant analysis for chat Cross Miles Carrier:
   Other participant: dispatch@crossmilescarrier.com - Cross Miles Carrier
ğŸ” Calling Google Directory API for user ID 105597362485153931945
âœ… Google Directory resolved 105597362485153931945 -> Cross Miles Carrier (cached)
ğŸ” User resolution for Cross Miles Carrier: {
  resolvedName: 'Cross Miles Carrier',
  storedDisplayName: 'Cross Miles Carrier',
  email: 'dispatch@crossmilescarrier.com',
  hasResolvedName: false,
  hasProperEmail: true,
  hasStoredDisplayName: true,
  shouldShow: true,
  showReason: 'proper_email'
}
âœ… Showing chat with reason: proper_email
âœ… Showing resolved user: Cross Miles Carrier
âœ… DM title from stored data: Cross Miles Carrier
â• Adding new chat for participant: Cross Miles Carrier
ğŸ‘¥ Found other participant via participants array: unknown@crossmilescarrier.com - Test Recipient
ğŸ” Participant analysis for chat Test Recipient:
   Other participant: unknown@crossmilescarrier.com - Test Recipient
ğŸ” Calling Google Directory API for user ID unknown_recipient
âŒ Google Directory API resolution failed for users/unknown_recipient: Resource Not Found: userKey (cached failure)
ğŸ” User resolution for Test Recipient: {
  resolvedName: null,
  storedDisplayName: 'Test Recipient',
  email: 'unknown@crossmilescarrier.com',
  hasResolvedName: null,
  hasProperEmail: true,
  hasStoredDisplayName: true,
  shouldShow: true,
  showReason: 'proper_email'
}
âœ… Showing chat with reason: proper_email
âœ… Showing resolved user: Test Recipient
âœ… DM title from stored data: Test Recipient
â• Adding new chat for participant: Test Recipient
ğŸ‘¥ Found other participant via participants array: narender@crossmilescarrier.com - narender
ğŸ” Participant analysis for chat narender:
   Other participant: narender@crossmilescarrier.com - narender
ğŸ” User resolution for narender: {
  resolvedName: null,
  storedDisplayName: 'narender',
  email: 'narender@crossmilescarrier.com',
  hasResolvedName: null,
  hasProperEmail: true,
  hasStoredDisplayName: true,
  shouldShow: true,
  showReason: 'proper_email'
}
âœ… Showing chat with reason: proper_email
âœ… Showing resolved user: narender
âœ… DM title from stored data: narender
â• Adding new chat for participant: narender
ğŸ‘¥ Found other participant via participants array: user-115048080534626721571@crossmilescarrier.com - User 11504808
ğŸ” Participant analysis for chat User 11504808:
   Other participant: user-115048080534626721571@crossmilescarrier.com - User 11504808
ğŸ” Calling Google Directory API for user ID 115048080534626721571
âŒ Google Directory API resolution failed for users/115048080534626721571: Resource Not Found: userKey (cached failure)
ğŸ” User resolution for user-115048080534626721571: {
  resolvedName: null,
  storedDisplayName: 'User 11504808',
  email: 'user-115048080534626721571@crossmilescarrier.com',
  hasResolvedName: null,
  hasProperEmail: false,
  hasStoredDisplayName: false,
  shouldShow: true,
  showReason: 'email_fallback'
}
âœ… Showing chat with reason: email_fallback
âœ… Showing resolved user: user-115048080534626721571
âœ… DM title from stored data: user-115048080534626721571
â• Adding new chat for participant: user-115048080534626721571
ğŸ‘¥ Found other participant via participants array: user-104329836262309309664@crossmilescarrier.com - User 10432983
ğŸ” Participant analysis for chat User 10432983:
   Other participant: user-104329836262309309664@crossmilescarrier.com - User 10432983
ğŸ” Calling Google Directory API for user ID 104329836262309309664
âŒ Google Directory API resolution failed for users/104329836262309309664: Resource Not Found: userKey (cached failure)
ğŸ” User resolution for user-104329836262309309664: {
  resolvedName: null,
  storedDisplayName: 'User 10432983',
  email: 'user-104329836262309309664@crossmilescarrier.com',
  hasResolvedName: null,
  hasProperEmail: false,
  hasStoredDisplayName: false,
  shouldShow: true,
  showReason: 'email_fallback'
}
âœ… Showing chat with reason: email_fallback
âœ… Showing resolved user: user-104329836262309309664
âœ… DM title from stored data: user-104329836262309309664
â• Adding new chat for participant: user-104329836262309309664
ğŸ‘¥ Found other participant via participants array: user-103074035611191657205@crossmilescarrier.com - User 10307403
ğŸ” Participant analysis for chat User 10307403:
   Other participant: user-103074035611191657205@crossmilescarrier.com - User 10307403
ğŸ” Calling Google Directory API for user ID 103074035611191657205
âŒ Google Directory API resolution failed for users/103074035611191657205: Resource Not Found: userKey (cached failure)
ğŸ” User resolution for user-103074035611191657205: {
  resolvedName: null,
  storedDisplayName: 'User 10307403',
  email: 'user-103074035611191657205@crossmilescarrier.com',
  hasResolvedName: null,
  hasProperEmail: false,
  hasStoredDisplayName: false,
  shouldShow: true,
  showReason: 'email_fallback'
}
âœ… Showing chat with reason: email_fallback
âœ… Showing resolved user: user-103074035611191657205
âœ… DM title from stored data: user-103074035611191657205
â• Adding new chat for participant: user-103074035611191657205
ğŸ“ Adding deduplicated chat: Cross Miles Carrier
ğŸ“ Adding deduplicated chat: Test Recipient
ğŸ“ Adding deduplicated chat: narender
ğŸ“ Adding deduplicated chat: user-115048080534626721571
ğŸ“ Adding deduplicated chat: user-104329836262309309664
ğŸ“ Adding deduplicated chat: user-103074035611191657205
ğŸ“Š Response Status: 200
ğŸ“‹ Total chats returned: 9
ğŸ¯ Narender chat found: âœ… YES
   Title: "narender"
   Messages: 3
   Space Type: DIRECT_MESSAGE
ğŸ¯ Dispatch chat found: âœ… YES
   Title: "Cross Miles Carrier"
   Messages: 2
   Space Type: DIRECT_MESSAGE

ğŸ“‹ All chats returned:
   1. "TEST GROUPS" (SPACE) - 0 messages
   2. "TEST2" (SPACE) - 0 messages
   3. "CMC" (SPACE) - 5 messages
   4. "Cross Miles Carrier" (DIRECT_MESSAGE) - 2 messages
   5. "Test Recipient" (DIRECT_MESSAGE) - 1 messages
   6. "narender" (DIRECT_MESSAGE) - 3 messages
   7. "user-115048080534626721571" (DIRECT_MESSAGE) - 14 messages
   8. "user-104329836262309309664" (DIRECT_MESSAGE) - 15 messages
   9. "user-103074035611191657205" (DIRECT_MESSAGE) - 1 messages

ğŸ‰ SUCCESS: Both target chats are now showing in the API!
âœ… The fix is working correctly.
ğŸ”Œ Disconnected from database
